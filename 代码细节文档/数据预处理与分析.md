# 数据预处理与可视化分析技术细节备忘录 (最终完整版)

**主题：** 关于赛题C的数据预处理、可视化及量化全流程技术细节

---

### 1. 数据加载与整合

- **流程概述**：我们的起点是包含三个工作表（表单1、2、3）的 `附件.xlsx`文件。首要任务是将包含基本信息（类型、纹饰、颜色等）的 `表单1`和包含化学成分的 `表单2`整合成一个统一的分析数据集。
- **核心技术挑战**：在整合中发现，`表单2`缺少可直接用于合并的 `文物编号`列。
- **解决方案与理由**：通过对 `表单2`中 `文物采样点`列的观察，我们发现其前缀数字与 `表单1`中的 `文物编号`存在明确的对应关系（例如，“03部位1”对应编号3）。因此，我们通过正则表达式 `(\d+)`从 `文物采样点`中提取了这部分数字，创建了一个新的 `文物编号`列，成功地将两个数据源精确匹配并合并。

### 2. 数据清洗

数据清洗是保证后续所有分析可靠性的基石。我们主要处理了缺失值和异常样本。

- **2.1 缺失值处理**
    - **化学成分列（表单2与表单3）**：
      - **处理方式**：将所有化学成分列中出现的空白值（Pandas读取为NaN）全部填充为0。
      - **理由**：严格遵循题目描述中的定义：“空白处表示未检测到该成分”。因此，将“未检测到”处理为含量为0，是最忠实于问题设定的做法。
    - **分类特征列（表单1的“颜色”）**：
      - **处理方式**：我们采纳了一种高级的条件众数填充法。对于一个颜色信息缺失的样本，系统会自动寻找数据集中所有与该样本在 `类型`、`表面风化`和 `纹饰`上完全一致的其他样本，然后用这个小群体中出现次数最多的颜色（众数）来填充缺失值。
      - **理由**：这种方法相比于用全局众数填充，更加精准和符合逻辑。它假设特征相似的文物，其颜色也可能相似。确保了数据的完整性。
- **2.2 异常样本筛选**
    - **处理方式**：计算每个样本所有化学成分的累加和，并筛选出总和介于85%到105%之间的数据作为有效样本。得到 67 条有效已分类样本 和 8 条有效未分类样本。
    - **理由**：严格遵循题目给出的有效数据定义，剔除可能由测量误差等导致的异常数据点，保证分析数据集的质量。

### 3. 预处理可视化佐证

- **流程概述**：我们生成了一系列图表，用以佐证和展示数据预处理（特别是缺失值处理）的每个步骤和综合效果。
- **图表构成与意义**：
  - **颜色填充依据佐证** (`表_颜色填充依据.xlsx`): 该表格清晰地展示了条件众数填充法的实施细节和依据。
  - **化学成分填充前后分布对比图**: 该图直观地展示了对 `表单2`填充0后，数据分布形态的变化，体现了原始数据中“未检出”情况的普遍性。
  - **预处理效果对比总览图**: 这张包含8个子图的综合看板，系统性地从类别占比、有效数据量、数据分布等多个维度，全面总结了数据预处理的效果。
  - **分类数据平衡性检验图** (`旭日图`): 该图展示了核心分类变量（类型、风化）的样本量均衡，证明后续建模无需进行特殊的不平衡处理。

### 4. 数据量化（特征工程）

在完成所有清洗和探索性分析后，为使数据能被机器学习模型所用，我们对数据进行了最终的数值化转换。

- **4.1 因变量（y - 预测目标）量化**
    - **对象**：`类型`列。
    - **方法**：标签编码（Label Encoding）。
    - **细节**：将“铅钡”映射为 `0`，“高钾”映射为 `1`。
    - **理由**：这是处理二分类问题目标变量的标准方法，`0`和 `1`仅作为两个独立类别的ID，模型不会将其理解为数值大小。
- **4.2 自变量（X - 预测特征）量化**
    - **对象**：`表面风化`、`纹饰`、`颜色`等分类特征。
    - **方法**：独热编码（One-Hot Encoding）。
    - **理由**：我们详细讨论并排除了顺序编码（会为类别引入虚假的、不存在的顺序和距离关系）和RGB向量（数据探索表明其缺乏科学依据）的方案，最终确定独热编码为最科学、最忠实于数据本身特性的方法。
- **4.3  数据量化流程总结 (可视化佐证)**
    - **用途**：为清晰总结整个数据量化流程，我们制作了 `数据量化流程总结.png` 图表。
    - **表述说明**：该图系统性地展示了我们将原始数据转换为机器学习可用特征矩阵的完整过程。它将变量按其在模型中的角色（因变量、自变量-数值型、自变量-分类）进行划分，并对每种角色的量化方法及其选择理由进行了详细阐述，可作为论文“模型与方法”章节的核心示意图。
