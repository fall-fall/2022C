# 数据预处理与探索性分析技术细节备忘录

---

### 1. 数据加载与整合

- **流程概述**：我们的起点是包含三个工作表（表单1、2、3）的 `附件.xlsx`文件。首要任务是将包含基本信息（类型、纹饰、颜色等）的 `表单1`和包含化学成分的 `表单2`整合成一个统一的分析数据集。
- **核心技术挑战**：在整合中发现，`表单2`缺少可直接用于合并的 `文物编号`列。
- **解决方案与理由**：通过对 `表单2`中 `文物采样点`列的观察，我们发现其前缀数字与 `表单1`中的 `文物编号`存在明确的对应关系（例如，“03部位1”对应编号3）。因此，我们通过正则表达式 `(\d+)`从 `文物采样点`中提取了这部分数字，创建了一个新的、数据类型为整数的 `文物编号`列。这一步骤是成功合并两个数据源的关键，确保了每个样本的化学成分都能与其物理描述精确匹配。`表单3`（未分类数据）也进行了同样的操作以保证数据结构一致。

### 2. 数据清洗

数据清洗是保证后续所有分析可靠性的基石。我们主要处理了缺失值和异常样本。

- **2.1 缺失值处理**

  - **化学成分列**：
    - **处理方式**：将所有化学成分列中出现的空白值（Pandas读取为NaN）全部填充为0。
    - **理由**：严格遵循题目描述中的定义：“空白处表示未检测到该成分”。因此，将“未检测到”处理为含量为0，是最忠实于问题设定的做法。
  - **分类特征列（以“颜色”为例）**：
    - **处理方式**：我们采纳了一种高级的条件众数填充法。对于一个颜色信息缺失的样本，系统会自动寻找数据集中所有与该样本在 `类型`、`表面风化`和 `纹饰`上完全一致的其他样本，然后用这个小群体中出现次数最多的颜色（众数）来填充缺失值。
    - **理由**：这种方法相比于用全局众数填充，更加精准和符合逻辑。它假设特征相似的文物，其颜色也可能相似。我们还设计了备用方案：如果在一个小群体中找不到可用的众数（例如群体内所有样本颜色都缺失），则填充为“未知”，确保了数据的完整性。
- **2.2 异常样本筛选**

  - **处理方式**：计算每个样本所有化学成分的累加和，并筛选出总和介于85%到105%之间的数据作为有效样本。
  - **理由**：这同样是严格遵循题目给出的有效数据定义。此举剔除了可能由测量误差等导致的异常数据点，保证了分析数据集的质量。经过筛选，我们最终获得了67条有效的已分类样本和8条有效的未分类样本。
- **2.3 稀有类别处理决策**

  - **决策过程**：我们曾讨论过将样本量极少（如少于5次）的类别（如某些特殊的颜色或纹饰）合并为一个“其他”类别的方案。该方案的优点在于可以增强统计检验的可靠性并避免机器学习模型过拟合。
  - **最终方案与理由**：经过讨论，我们最终采纳了“**忠于原始数据**”的原则，**不进行稀有类别合并**。这一决策的理由是，我们希望保留最完整、最原始的信息粒度，让后续的模型自己去学习这些稀有类别的权重，而不是人为地引入信息损失。

### 3. 数据量化（特征工程）

为使数据能被机器学习模型所用，我们对文本类数据进行了数值化转换。

- **3.1 因变量（y - 预测目标）量化**

  - **对象**：`类型`列。
  - **方法**：标签编码（Label Encoding）。
  - **细节**：将“铅钡”映射为 `0`，“高钾”映射为 `1`。
  - **理由**：这是处理二分类问题目标变量的标准方法，`0`和 `1`仅作为两个独立类别的ID，模型不会理解为其数值大小。
- **3.2 自变量（X - 预测特征）量化**

  - **对象**：`表面风化`、`纹饰`、`颜色`等分类特征。
  - **方法**：独热编码（One-Hot Encoding）。
  - **理由**：我们详细讨论并排除了使用 `0, 1, 2...`顺序编码的方案，因为这会错误地为“A纹饰”、“B纹饰”之间引入不存在的顺序和距离关系。独热编码通过创建新的二进制列，完美地解决了这个问题，它只表达“是/否”的概念，不引入任何虚假信息。
  - **另一个被否决的方案（RGB向量）**：我们还深入探讨了使用RGB向量表示颜色的可能性。通过对 `氧化铜(CuO)`和 `氧化铁(Fe2O3)`这两种关键着色剂与颜色关系的数据探索，我们发现颜色与单一化学成分之间不存在简单的单调演化关系。这一数据证据表明，将颜色名称主观地映射到RGB坐标的风险极高。因此，我们最终决定不采用此方案，以保证分析的严谨性。
- **3.3  数据量化流程总结**

  - **用途**：为清晰直观地总结整个数据量化流程，我们制作了如下的流程示意图，详细说明了不同类型变量的处理方法、背后原理及最终形态。
  - **表述说明**：该图（`数据量化流程总结.png`）系统性地展示了我们将原始数据转换为机器学习可用特征矩阵的完整过程。它将变量按其在模型中的角色（因变量、自变量-数值型、自变量-分类）进行划分，并对每种角色的量化方法（如标签编码、独热编码）及其选择理由进行了详细阐述。这张图表可以作为论文“模型与方法”章节的核心示意图，用以证明我们特征工程的严谨性与合理性。

### 4. 探索性数据分析（EDA）与图像用途说明

我们在预处理的基础上，生成了一系列可视化图表，用于洞察数据规律并支撑论文结论。

- **图1：分类特征样本数量分布.png**

  - **用途**：用于在论文中展示我们所用数据集的基本构成。
  - **表述说明**：该图展示了清洗后数据集中主要分类特征的样本构成。从图中可以清晰地看出，高钾与铅钡玻璃的样本量较为均衡（28 vs 39），风化与无风化样本也均有足够数量，这为后续分类模型的建立和对比分析提供了良好的数据基础。
- **图2：核心化学成分含量分布.png**

  - **用途**：作为问题二“分类规律”分析的核心可视化证据。
  - **表述说明**：该图通过核密度估计直观地揭示了不同类型玻璃在关键化学成分上的显著差异。例如，在氧化铅(PbO)的分布上，铅钡玻璃（红色）呈现出明显的高含量峰值，而高钾玻璃（蓝色）则几乎为零，这有力地证明了PbO是区分两种玻璃的决定性特征。类似的结论也适用于氧化钾(K2O)。
- **图3：斯皮尔曼相关性对比热力图.png**

  - **用途**：作为问题四“化学成分关联关系对比”的直接回答。
  - **算法选择理由**：我们特意选择了**斯皮尔曼相关性**而非默认的皮尔逊。理由是斯皮尔曼不要求变量间呈线性关系，只衡量单调性，且对异常值更不敏感，分析结果更为稳健。
  - **表述说明**：为回答问题四，我们分别对高钾和铅钡玻璃的化学成分进行了斯皮尔曼相关性分析。通过对比两张热力图可以发现两种玻璃内部化学体系的显著差异，例如，在铅钡玻璃中，PbO与SiO₂呈现出强烈的负相关，这印证了PbO作为助熔剂的角色。而在高钾玻璃中，这种关系不存在，取而代之的是K₂O与其他成分的关联模式，这揭示了两种玻璃因助熔剂不同而导致的内在化学结构差异。
- **图4：问题三探索性分析PCA图.png**

  - **用途**：从宏观上展示数据的整体结构，并为问题三“未知样本鉴别”提供强有力的探索性证据。
  - **算法选择理由**：主成分分析（PCA）是高维数据可视化的标准方法。我们在应用前对数据进行了标准化，以消除不同化学成分含量范围差异带来的影响，这是保证PCA结果有效性的必要步骤。
  - **表述说明**：该图利用主成分分析（PCA）将14维的化学成分空间降维至二维平面。从图中可见，已知的高钾（蓝色）与铅钡（红色）样本形成了两个泾渭分明的簇，证明了仅凭化学成分即可实现高效分类。此外，我们将8个未知样本（绿色X）投影到该空间，发现其全部落入铅钡玻璃的簇内，为问题三的最终鉴别提供了强有力的初步视觉证据。
