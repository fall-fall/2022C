# 问题二：玻璃文物分类、亚类划分及可靠性分析 - 最终技术实现文档

### **摘要**

本报告旨在为论文撰写者提供一份关于问题二解决方案的详尽技术备忘录。报告遵循一个三模块的综合分析流程。**模块一**，我们通过探索性数据分析（EDA）形成假设，继而构建并评估了线性和非线性两种支持向量机（SVM）模型，并利用权重分析与SHAP框架深度剖析了高钾与铅钡玻璃的分类规律。**模块二**，我们基于**变异系数(CV)**的原则科学地筛选了用于聚类的化学特征，通过层次聚类方法并结合定量指标确定了最佳亚类数量，最终利用PCA和热力图对亚类进行了可视化“画像”。**模块三**，我们设计并执行了严格的合理性与敏感性分析，通过SVM权重稳定性检验和针对聚类的**特征值扰动法**与调整兰德指数（ARI）评估，全面验证了本研究结论的科学性与稳健性。

---

### **模块一：高钾玻璃与铅钡玻璃的分类规律分析**

#### **1.1 探索性数据分析 (EDA)**

* **目的与方法选择理由**
  在进行任何复杂的建模之前，首要任务是通过探索性数据分析（EDA）对数据建立直观且深刻的认知。我们采用描述性统计和并列箱线图，因为它们是最高效、最直观的两种方法，能够快速揭示不同类别数据在数值特征上的分布差异，为后续的建模方向和假设形成提供科学依据。
* **图表介绍与分析：`EDA_并列箱线图.png`**
  * **图片用途说明**：此图旨在直观对比高钾玻璃与铅钡玻璃在全部14种化学成分含量上的分布差异。
  * **图像内容解读**：图中，Y轴为化学成分，X轴为含量百分比。对于每一种成分，都并排展示了两个箱体，分别代表高钾玻璃和铅钡玻璃的含量分布情况。
  * **分析与结论**：该图提供了极强的视觉证据。在 `氧化铅(PbO)`和 `氧化钡(BaO)`两种成分上，铅钡玻璃的含量分布远高于高钾玻璃；而在 `氧化钾(K2O)`上则呈现完全相反的模式。两个类别在这些关键成分上的箱体几乎没有重叠，形成了核心假设：**PbO、BaO与K2O是区分两类玻璃的最关键指标**。

#### **1.2 双模型建立与性能评估**

* **模型选择理由与算法介绍**
  * **线性支持向量机 (Linear SVM)**
    * **选择理由**：为直接、清晰地回答“分类规律是什么”，我们首选线性SVM。其模型形式简单，结果是一个线性的决策超平面，其权重系数 `coef_`能够直观地、定量地反映每个特征对于分类决策的贡献方向与大小。
    * **算法原理**：线性SVM的目标是在N维特征空间中，寻找一个(N-1)维的最优决策超平面，该超平面不仅能将两类样本点分开，还能使得离它最近的样本点（支持向量）到它的几何间隔最大化。
  * **RBF核支持向量机 (RBF SVM)**
    * **选择理由**：为探索数据的可分性上限，并验证规律在更复杂模型下的表现，我们选择性能强大的RBF核SVM。它能构建非线性决策边界，更好地拟合化学成分间可能存在的复杂关系。
    * **算法原理**：当数据线性不可分时，RBF核SVM通过“核技巧”将原始特征空间映射到更高维空间，在新空间中寻找线性超平面，当这个超平面映射回原始空间时，就形成复杂的非线性决策边界。
  * **性能评估方法：10折交叉验证**
    * **选择理由**：对于小样本数据集，10折交叉验证通过轮流分割数据进行训练和测试，能有效避免单次划分带来的偶然性，是更稳定、更可靠的性能评估方法。
  * **结果解读**：交叉验证结果显示，线性SVM的平均准确率为**95.71%**，RBF核SVM的平均准确率高达**97.14%**。两者均表现出极高的分类性能。

#### **1.3 分类规律的双重解释**

* **图表介绍与分析：`线性SVM特征权重.png`**
  * **图片用途说明**：此图用于直观展示线性SVM模型学习到的各特征权重，从而解释其分类规律。
  * **图像内容解读**：图中，Y轴为最重要的部分特征，X轴为权重系数值。正向权重将预测推向“高钾玻璃”，负向权重将预测推向“铅钡玻璃”。
  * **分析与结论**：`氧化钾(K2O)`和 `二氧化硅(SiO2)`获得了最大的正权重，而 `氧化铅(PbO)`和 `氧化钡(BaO)`获得了最大的负权重，这与EDA的发现完全一致。
* **解释工具：SHAP (SHapley Additive exPlanations)**
  * **选择理由**：为解释高性能但“黑箱”的RBF核SVM，我们采用SHAP框架，它基于博弈论，能够公平、准确地将模型的预测结果归因到每个输入特征上。
* **图表介绍与分析：`SHAP摘要图.png`**
  * **图片用途说明**：此图是SHAP分析的核心，用于展示全局特征重要性，以及特征值对模型输出影响的方向和模式。
  * **图像内容解读**：Y轴按重要性高低排列特征，X轴是SHAP值，点的颜色代表该特征原始值的大小（红高蓝低）。
  * **分析与结论**：该图再次确认 `PbO`和 `K2O`是最重要的特征。并且它提供了更丰富的细节：高含量的 `PbO`（红点）总是对应着强烈的负向SHAP值；而高含量的 `K2O`（红点）则总是对应着强烈的正向SHAP值。

---

### **模块二：各类别内部的亚类划分与合理性分析**

**2.0 亚类划分的数据预处理 (构建以文物为单位的分析数据集)**

* **目的与挑战**

  * **核心目的**：亚类划分旨在探索**不同文物之间**是否存在更细微的群组。因此，分析的最小单元必须是**“文物”**，而非“采样点”。我们需要构建一个每个文物只对应一行数据的分析集。
  * **面临的挑战**：
    1. **数据不独立**：部分文物存在多个采样点，这些数据点并非相互独立的观测。
    2. **数据状态不一致**：部分总体标记为“风化”的文物，其实际采样点可能包含“未风化点”，其化学状态与我们的分析目标不符。
    3. **数据缺失**：部分“风化”文物没有任何能直接代表其风化状态的采样点数据。
* **核心处理思想与方案**
  为应对上述挑战，我们制定了一套以“**探究文物经历风化后的最终状态分类**”为核心目标的预处理方案。该方案旨在为每一个文物（无论其原始采样情况如何），都生成一个最能代表其**风化后化学特征**的数据点。
* **具体执行规则**
  我们遍历每一个独一无二的文物，并根据其“表面风化”的总体标记，应用以下规则：

  1. **对于“未风化”文物**：若存在多个采样点（如“部位1”、“部位2”），则对其化学成分**取平均值**。这旨在消除采样位置带来的随机误差，得到该文物最稳定的原始成分表达。
  2. **对于“风化”文物**：处理逻辑更为复杂，旨在获取其最能代表**风化后状态**的数据：
     * **2a. 优先选取风化代表点**：我们首先寻找能代表其风化状态的采样点。根据最终方案，这包括所有**未被明确标记为“未风化点”**的采样点（如“部位1”、“严重风化点”等）。若存在多个此类采样点，则对其化学成分**取平均值**。
     * **2b. 实施分级条件均值插补**：若一个“风化”文物不存在任何可用的风化代表点（即其所有采样点均被标记为“未风化点”），则启动**分级条件均值插补**程序，为其估算一个风化后的化学成分。插补时，我们在一个预先构建的“风化样本参考库”中，按以下优先级为该文物寻找外观相似的样本进行匹配并取其成分均值：
       * **第一优先级**：精确匹配 `类型` + `颜色` + `纹饰`。
       * **第二优先级**：若无完全匹配，则放宽条件，匹配 `类型` + `颜色`。
       * **第三优先级**：若仍无匹配，则进一步放宽，只匹配 `类型`。
* **最终产出**
  经过此流程，我们成功地将原始的、混杂的数据，转换为了一个包含**34个独立文物**的、成分状态高度一致的最终数据集（`亚类划分预处理后数据_分级插补.xlsx`），为后续所有聚类分析的有效性和可靠性奠定了坚实基础。


#### **2.1 基于变异系数的特征选择**

* **方法选择理由**：亚类划分的目标是寻找**同一个类别内部的差异**。与方差相比，**变异系数（CV = 标准差 / 均值）**是一个无量纲的相对离散指标，它消除了不同化学成分自身含量均值大小的影响，能更公平、更科学地比较各特征的“真实”变异程度。因此，我们选择类内变异系数最大的特征。
* **图表介绍与分析：`..._特征选择箱线图.png`**
  * **图片用途说明**：此图用于对筛选出的高变异系数候选特征进行可视化，以验证其数据分布是否适合聚类。
  * **分析与结论**：图中显示，我们筛选出的特征，其箱体普遍较宽或存在较多离群点，说明其数据分布离散，具备将样本区分为不同群组的潜力。

#### **2.2 最佳亚类数量(K)的确定**

* **方法选择理由与算法介绍**
  * **层次聚类 (Hierarchical Clustering)**
    * **选择理由**：在不知道确切亚类数量（K值）的情况下，层次聚类是一种理想的探索性方法，其树状图（Dendrogram）能直观展示数据完整的嵌套结构。
  * **轮廓系数法 (Silhouette Score)**
    * **选择理由**：为弥补观察树状图的主观性，我们引入轮廓系数作为定量评估指标，它通过计算簇的内聚性和分离度来客观地寻找最佳K值。
* **图表介绍与分析**
  * **`..._层次聚类树状图.png`**：此图用于展示样本的层次化聚合过程，为选择最佳K值提供定性依据。
  * **`..._最佳K值选择.png`**：此图通过绘制不同K值对应的轮廓系数，为选择最佳K值提供定量依据。图中显示，高钾玻璃的轮廓系数在**K=5**时达到峰值；铅钡玻璃在**K=2**时达到峰值。

#### **2.3 最终聚类与“画像”**

* **图表介绍与分析**
  * **`..._亚类PCA图.png`**：此图利用PCA降维，将高维的聚类结果投影到二维平面上，以直观地检验亚类划分的有效性。
  * **`..._亚类热力图_带编号.png`**：这是**解读亚类内在特征**的核心工具。通过观察每个亚类区域内部的“垂直颜色条带”，我们可以为每个亚类进行“画像”，例如将铅钡玻璃的两个亚类命名为“高铅钡助熔剂型”和“高硅基质型”。

---

### **模块三：敏感性分析**

#### **3.1 分类模型的可靠性**

* **方法选择理由**：为证明我们得到的“分类规律”不是由偶然的数据划分导致的，我们通过在K折交叉验证的每一次折叠中，重新训练模型并提取其权重，来直接评估规律本身的稳健性。
* **图表介绍与分析：`SVM权重稳定性分析.png`**
  * **图片用途说明**：此图通过箱线图展示了关键特征的SVM权重在10次不同数据子集训练中的分布情况。
  * **分析与结论**：图中显示，关键特征（如 `PbO`, `K2O`）的权重符号在10次实验中从未改变，且箱体很短，波动极小。**这强有力地证明了我们提炼出的分类规律是高度稳健和可信的。**

#### **3.2 亚类划分的敏感性**

* **方法选择理由与算法介绍**：

  * **特征值扰动法 + 调整兰德指数 (ARI)**
    * **选择理由**：为检验亚类划分结果对**化学成分测量误差**的容忍度，我们采用了特征值扰动法。该方法更贴近问题的物理现实，通过向数据中注入不同水平的随机噪声，来测试聚类结构的稳定性。
    * **算法原理**：我们对筛选出的特征数据乘以一个 `[1-p, 1+p]`范围内的随机扰动因子（p为扰动水平），在此扰动数据上重新聚类，并使用调整兰德指数（ARI）来衡量该次聚类结果与原始基准结果的一致性。对每个扰动水平重复此过程上千次并取ARI均值。
* **图表介绍与分析：`最终灵敏度分析_特征扰动折线图.png(后面会改成类似玫瑰图表示)`**

  * **图片用途说明**：此图通过折线图展示了在不同扰动水平下，高钾和铅钡玻璃亚类划分的平均ARI分数。
  * **图像内容解读**：X轴为模拟的“测量误差”（扰动水平%），Y轴为平均ARI分数。曲线越高、下降越平缓，说明聚类结果越稳健。
  * **分析与结论**：
    * **高钾玻璃**：其ARI曲线即使在±10%的巨大扰动下，平均ARI分数依然高达**0.9513**，在±50%的极端扰动下，ARI仍有**0.6406**。这说明其K=5的亚类结构**极其稳健**，对测量误差有很强的抵抗力，是高度可信的发现。
    * **铅钡玻璃**：其ARI曲线同样表现出惊人的稳定性。在±10%的扰动下，平均ARI为**0.9596**，在±20%的扰动下，仍有**0.8236**。即使在±50%的极端扰动下，ARI分数也维持在**0.6250**。
* > 特征值扰动敏感性分析表明，在面临高达±20%的潜在测量误差时，其核心划分依然能够保持高度一致（平均ARI > 0.8）。**这强有力地证明了分类结构是真实且稳健的，而非随机伪影。** 因此，我们最终判定，**应划分为k个具有不同化学特征的亚类。**
  >
